= stylesheet_link_tag 'element-ui@2.4.11.css'
= javascript_include_tag 'element-ui@2.4.11.js'

%ol.breadcrumb
  %li 应用中心
  %li= link_to "应用管理", url_for("/")
  %li= link_to @app.name, url_for("/#{@app.uuid}")
  %li 上传版本

:css
  .upload-demo,
  .upload-demo .el-upload,
  .upload-demo .el-upload .el-upload-dragger {
    width: 100%;
    min-height: 300px;
  }
  .upload-demo .el-upload .el-upload-dragger {
    padding-top: 50px;
  }
  .upload-version-container .el-icon-upload {
    font-size: 67px;
    color: #c0c4cc;
    margin: 40px 0 16px;
    line-height: 50px;
  }
  .upload-demo .el-upload__input {
    display: none;
  }
  .upload-demo .el-upload__tip {
    text-align: center;
  }
#appVersionUpload.row
  .col-md-2
  .col-md-8
    %el-upload.upload-demo{':action' => 'action', ':data' => 'data', drag: true, multiple: false, accept: '.jar,.war', 'auto-upload' => true, ':on-success' => 'uploadOnSuccess', ':on-error' => 'uploadOnError', ':on-change' => 'uploadOnChange'}
      %i.el-icon-upload
      .el-upload__text
        将文件拖到此处，或
        %em 点击上传
        %br
        （只能上传war/jar文件，且不超过100mb）

:javascript
  new Vue({
    el: '#appVersionUpload',
    data: function() {
      return { 
        app: #{@app.to_hash.to_json},
        action: null,
        data: {}
      }
    },
    created() {
      this.action = '#{url_for('/')}' + this.app.uuid + '/version/upload'
      this.data = {app_id: this.app.id, app_uuid: this.app.uuid}
      console.log('app:', this.app)
      console.log('action:', this.action)
    },
    methods: {
      uploadOnError(err, file, fileList) {
        console.log('uploadOnError', err, file, fileList)
      },
      uploadOnSuccess(response, file, fileList) {
        console.log('uploadOnSuccess', response, file, fileList)
        if(response.code == 201) {
          let recirectTo = window.location.href.replace(window.location.pathname, response.data)
          window.location.replace(recirectTo)
        }
      },
      uploadOnChange(file, fileList) {
        console.log('uploadOnChange', file, fileList)
      }
    }
  })
